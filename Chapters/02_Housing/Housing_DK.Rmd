---
title: "Housing: Denmark"
author: "Christian Kruse"
date: "`r Sys.Date()`"
output: html_document
---

```{r housing_dk}
knitr::opts_chunk$set(echo = TRUE,include=TRUE,messsage=TRUE,error=TRUE)
options(scipen=999)

```

```{r }
if (!require(pacman)) { install.packages("pacman") }
pacman::p_load(tidyr,
               dplyr,
               ggplot2,
               boot,
               openxlsx,
               lubridate,
               forcats,
               broom,
               purrr,
               caret,
               glue,
               devtools,
               # gam,
               TTR,
               dkstat,
               httr,
               randomForest,
               zoo,
               rvest)
source(file = "money_theme.R")


```

```{r repreex1}
# Load required libraries
library(caret)
library(dplyr)
library(ggplot2)

# Set seed for reproducibility
set.seed(42)

# Generate a synthetic dataset
n <- 100
group <- factor(sample(1:3, n, replace = TRUE))
x1 <- runif(n, 0, 10)
x2 <- runif(n, 0, 10)
y <- 3 * x1 + 2 * x2 + rnorm(n, mean = 0, sd = 3)

# Combine the variables into a data.frame
data <- data.frame(group, x1, x2, y)

# Split the data into training and testing sets
train_indices <- createDataPartition(y, p = 0.7, list = FALSE)
train_data <- data[train_indices, ]
test_data <- data[-train_indices, ]
```

```{r repreex2}
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = data,
    method = "rf",
    trControl = trainControl(method = "cv", number = 10)
  )
```

```{r repreex2a}
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = data,
    method = "bam",
    trControl = trainControl(method = "cv", number = 10)
  )
```

```{r repreex2b}
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = data,
    method = "gamboost",
    trControl = trainControl(method = "cv", number = 10)
  )
```

```{r repreex2c}
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = data,
    method = "gam",
    trControl = trainControl(method = "cv", number = 10)
  )
```

```{r repreex3}
# Function to train gamLoess model for each group
train_gamLoess_group <- function(group_data) {
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = group_data,
    method = "rf",
    trControl = trainControl(method = "cv", number = 10)
  )
  return(gamLoess_model)
}

# Train gamLoess models for each group
models_by_group <- train_data %>%
  group_by(group) %>%
  do(gamLoess_model = train_gamLoess_group(.))


```

```{r repreex4}
  gamLoess_model <- train(
    y ~ x1 + x2,
    data = data,
    method = "gamLoess",
    trControl = trainControl(method = "cv", number = 10)
  )
```

